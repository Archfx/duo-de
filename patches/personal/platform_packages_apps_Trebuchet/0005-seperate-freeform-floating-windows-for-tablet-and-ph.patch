From 44d675fa1af922ece924cd636273c44120e37263 Mon Sep 17 00:00:00 2001
From: Archfx <cybx@live.com>
Date: Sun, 6 Oct 2024 11:49:14 -0400
Subject: [PATCH] seperate freeform floating windows for tablet and phone mode

---
 res/values/strings.xml                        |  7 +-
 res/xml/launcher_preferences.xml              | 14 ++-
 .../util/ActivityOptionsWrapper.java          | 17 +++-
 3 files changed, 33 insertions(+), 5 deletions(-)
 

diff --git a/res/values/strings.xml b/res/values/strings.xml
index f784572437..4659807f0d 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -483,5 +483,10 @@
     <!-- content description for the overflow bubble [CHAR_LIMIT=none] -->
     <string name="bubble_bar_overflow_description">Overflow</string>
 
-    <string name="allow_freeform_mode">Enable desktop mode</string>
+    <!-- DUO-DE Strings for the app launch mode -->
+    <string name="allow_freeform_mode_tablet">Tablet Mode Floating Windows</string>
+    <string name="allow_freeform_mode_tablet_desc">Enable desktop mode in Book and Slate Postures</string>
+    <string name="allow_freeform_mode_phone">Phone Mode Floating Windows</string>
+    <string name="allow_freeform_mode_phone_desc">Enable desktop mode in Tent, Ramp, and Brochure Postures</string>
+
 </resources>
diff --git a/res/xml/launcher_preferences.xml b/res/xml/launcher_preferences.xml
index d5970b3afb..0bab4b4a71 100644
--- a/res/xml/launcher_preferences.xml
+++ b/res/xml/launcher_preferences.xml
@@ -97,10 +97,20 @@
         android:persistent="true" />
 
     <SwitchPreference
-        android:key="allow_freeform_mode"
-        android:title="@string/allow_freeform_mode"
+        android:key="allow_freeform_mode_tablet"
+        android:title="@string/allow_freeform_mode_tablet"
         android:defaultValue="true"
         android:persistent="true"
+        android:summary="@string/allow_freeform_mode_tablet_desc"
         />
+    
+    <SwitchPreference
+        android:key="allow_freeform_mode_phone"
+        android:title="@string/allow_freeform_mode_phone"
+        android:defaultValue="false"
+        android:persistent="true"
+        android:summary="@string/allow_freeform_mode_phone_desc"
+        />
+
 
 </androidx.preference.PreferenceScreen>
diff --git a/src/com/android/launcher3/util/ActivityOptionsWrapper.java b/src/com/android/launcher3/util/ActivityOptionsWrapper.java
index 20e6568b3a..fa338f6719 100644
--- a/src/com/android/launcher3/util/ActivityOptionsWrapper.java
+++ b/src/com/android/launcher3/util/ActivityOptionsWrapper.java
@@ -26,6 +26,8 @@ import java.lang.reflect.Method;
 import android.content.Context;
 import android.content.SharedPreferences;
 import android.content.SharedPreferences.OnSharedPreferenceChangeListener;
+import com.android.launcher3.DeviceProfile;
+import com.android.launcher3.views.ActivityContext;
 
 
 /**
@@ -58,8 +60,19 @@ public class ActivityOptionsWrapper {
         
         if (this.context != null) {
             SharedPreferences pref = this.context.getSharedPreferences(LauncherFiles.SHARED_PREFERENCES_KEY, Context.MODE_PRIVATE);
-            if(!pref.getBoolean("allow_freeform_mode", true)) 
-                mode = "fullscreen";
+            
+            Boolean freeformTablet = pref.getBoolean("allow_freeform_mode_tablet", true);
+            Boolean freeformPhone = pref.getBoolean("allow_freeform_mode_phone", false);
+            
+            Boolean isTabletMode = ActivityContext.lookupContext(this.context).getDeviceProfile().isTablet;
+
+            if (!isTabletMode) {
+                if (freeformPhone) mode = "freeform";
+                else mode = "fullscreen";
+            } else {
+                if (freeformTablet) mode = "freeform";
+                else mode = "fullscreen";
+            }
         }
             
         if (mode.equals("fullscreen")) {
-- 
2.34.1

